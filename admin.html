<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Royal NFT Market</title>
    <style>
        body { background: #04111d; color: white; font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .container { background: #18202a; padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
        h1 { color: #ffd700; text-align: center; }
        .nft-item { background: #0d1117; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #30363d; }
        .del-btn { background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #0d1117; border: 1px solid #30363d; border-radius: 10px; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background: #2081e2; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .success-msg { color: #00b09b; text-align: center; margin: 10px 0; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚙️ Control Panel</h1>
        
        <div id="login-section">
            <h3>Admin Access</h3>
            <input type="password" id="admin-pass" placeholder="Enter password">
            <button onclick="checkPass()">Login</button>
        </div>

        <div id="admin-content" style="display: none;">
            <div id="msg" class="success-msg">Action successful!</div>
            
            <h3>Pinata JWT Setup</h3>
            <input type="text" id="pinata-jwt" placeholder="Pinata JWT Token">
            <button onclick="saveJWT()" style="background: #ffd700; color: black;">Save JWT</button>

            <h3 style="margin-top: 30px;">Manage Marketplace NFT</h3>
            <div id="nft-list">
                <p style="color: #8a939b;">Loading items...</p>
            </div>
            
            <button onclick="window.location.href='index.html'" style="background: #6c757d; margin-top: 20px;">← Back to Market</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // ВОТ ТУТ Я ДОБАВИЛ getDoc
        import { getFirestore, collection, onSnapshot, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBT0bsUtte387SIkm3N2hddlvEFSVhB9RU",
            authDomain: "royal-nft.firebaseapp.com",
            projectId: "royal-nft",
            storageBucket: "royal-nft.firebasestorage.app",
            messagingSenderId: "616712040035",
            appId: "1:616712040035:web:59e449b2215e4126951256"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Простая проверка пароля (сделай свой)
        window.checkPass = async () => {
    const enteredPass = document.getElementById('admin-pass').value;
    
    try {
        // 1. Получаем ссылку на документ из коллекции settings с ID admin
        const adminDocRef = doc(db, "settings", "admin");
        
        // 2. Скачиваем этот документ из Firebase
        const adminSnap = await getDoc(adminDocRef);
        
        if (adminSnap.exists()) {
            const data = adminSnap.data();
            const correctPass = data.password; // Тот самый пароль из поля password в Firebase

            // 3. Сравниваем введенный пароль с паролем из базы
            if (enteredPass === correctPass) {
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadNFTs(); // Загружаем список NFT только после входа
            } else {
                alert("❌ Неверный пароль из Firebase!");
            }
        } else {
            alert("❌ Ошибка: В Firebase не создан документ 'admin' в коллекции 'settings'!");
        }
    } catch (error) {
        console.error("Ошибка при проверке пароля:", error);
        alert("❌ Произошла ошибка при подключении к базе данных.");
    }
};
        // Сохранение JWT (в локалсторедж браузера)
        window.saveJWT = () => {
            const jwt = document.getElementById('pinata-jwt').value;
            localStorage.setItem('pinata_jwt', jwt);
            showStatus();
        };

        function showStatus() {
            const msg = document.getElementById('msg');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        // Загрузка и удаление NFT
        function loadNFTs() {
            onSnapshot(collection(db, "nfts"), (snapshot) => {
                const list = document.getElementById('nft-list');
                list.innerHTML = '';
                snapshot.forEach(d => {
                    const nft = d.data();
                    const item = document.createElement('div');
                    item.className = 'nft-item';
                    item.innerHTML = `
                        <span>${nft.name}</span>
                        <button class="del-btn" onclick="deleteNFT('${d.id}')">Delete</button>
                    `;
                    list.appendChild(item);
                });
            });
        }

        window.deleteNFT = async (id) => {
            if(confirm("Delete this NFT from market?")) {
                await deleteDoc(doc(db, "nfts", id));
                showStatus();
            }
        };
        
        // Загрузка JWT если есть
        document.getElementById('pinata-jwt').value = localStorage.getItem('pinata_jwt') || "";
    </script>
</body>
</html>
