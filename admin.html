<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Royal NFT Control</title>
    <style>
        body { background: #04111d; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #18202a; padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: #ffd700; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        h3 { border-bottom: 1px solid #30363d; padding-bottom: 10px; margin-top: 30px; color: #ffd700; }
        .section { background: #0d1117; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #30363d; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #1c2531; border: 1px solid #30363d; border-radius: 10px; color: white; box-sizing: border-box; outline: none; font-family: inherit; }
        input:focus, textarea:focus { border-color: #ffd700; }
        button { width: 100%; padding: 14px; background: #2081e2; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 5px; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        .nft-item { background: #1c2531; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #ffd700; }
        .del-btn { background: #ff4757; width: auto; padding: 8px 15px; font-size: 12px; }
        #loading-overlay { display: none; text-align: center; color: #ffd700; margin: 10px 0; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üëë Admin Panel</h1>

    <div id="login-section">
        <div class="section">
            <h3>Authentication</h3>
            <input type="password" id="admin-pass" placeholder="Enter Admin Password">
            <button onclick="checkPass()">Login to System</button>
        </div>
    </div>

    <div id="admin-content" style="display: none;">
        
        <div class="section" style="border: 1px solid #00b09b;">
            <h3>üöÄ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ú–∏–Ω—Ç (Admin)</h3>
            <p style="font-size: 12px; color: #8a939b;">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ NFT —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º</p>
            <input type="text" id="admin-nft-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ NFT (–Ω–∞–ø—Ä. Royal Shark #1)">
            <input type="text" id="admin-nft-series" placeholder="–°–µ—Ä–∏—è/–ö–æ–ª–ª–µ–∫—Ü–∏—è (–Ω–∞–ø—Ä. Genesis Collection)">
            <textarea id="admin-nft-desc" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ... —á–µ–º —É–Ω–∏–∫–∞–ª–µ–Ω —ç—Ç–æ—Ç NFT?"></textarea>
            <input type="number" id="admin-nft-supply" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫ (Supply)" value="1">
            <input type="file" id="admin-nft-file" accept="image/*">
            <div id="loading-overlay">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ IPFS... –ü–æ–¥–æ–∂–¥–∏—Ç–µ...</div>
            <button onclick="adminMint()" style="background: #00b09b;">–°–æ–∑–¥–∞—Ç—å –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π NFT</button>
        </div>

        <div class="section">
            <h3>üîë Pinata Configuration</h3>
            <input type="text" id="pinata-jwt" placeholder="Your Pinata JWT Token">
            <button onclick="saveJWT()" style="background: #ffd700; color: #000;">Save Token</button>
        </div>

        <div class="section">
            <h3>üì¶ Market Items</h3>
            <div id="nft-list">
                <p style="text-align: center; color: #8a939b;">Loading marketplace...</p>
            </div>
        </div>

        <button onclick="window.location.href='index.html'" style="background: #30363d;">‚Üê Exit to Site</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBT0bsUtte387SIkm3N2hddlvEFSVhB9RU",
        authDomain: "royal-nft.firebaseapp.com",
        projectId: "royal-nft",
        storageBucket: "royal-nft.firebasestorage.app",
        messagingSenderId: "616712040035",
        appId: "1:616712040035:web:59e449b2215e4126951256"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.checkPass = async () => {
        const enteredPass = document.getElementById('admin-pass').value;
        try {
            const adminDoc = await getDoc(doc(db, "settings", "admin"));
            if (adminDoc.exists() && enteredPass === adminDoc.data().password) {
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadNFTs();
            } else {
                alert("‚ùå Wrong Admin Password!");
            }
        } catch (e) {
            alert("‚ùå Database Error.");
        }
    };

    window.adminMint = async () => {
        const file = document.getElementById('admin-nft-file').files[0];
        const jwt = localStorage.getItem('pinata_jwt');
        const name = document.getElementById('admin-nft-name').value;
        const series = document.getElementById('admin-nft-series').value;
        const desc = document.getElementById('admin-nft-desc').value;
        const supply = document.getElementById('admin-nft-supply').value;
        const loader = document.getElementById('loading-overlay');

        if (!file || !jwt || !name) {
            alert("–ó–∞–ø–æ–ª–Ω–∏ –∏–º—è –∏ –≤—ã–±–µ—Ä–∏ —Ñ–∞–π–ª!"); return;
        }

        try {
            loader.style.display = 'block';
            const formData = new FormData();
            formData.append('file', file);
            const res = await fetch("https://api.pinata.cloud/pinning/pinFileToIPFS", {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${jwt}` },
                body: formData
            });
            const data = await res.json();
            if (!data.IpfsHash) throw new Error("Pinata error");

            const imageUrl = `https://gateway.pinata.cloud/ipfs/${data.IpfsHash}`;

            await addDoc(collection(db, "nfts"), {
                name: name,
                series: series || "Collection",
                description: desc || "Exclusive Royal NFT",
                supply: supply || "1",
                image: imageUrl,
                createdAt: Date.now(),
                isAdmin: true
            });

            alert("‚úÖ NFT —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ!");
            location.reload();
        } catch (e) {
            alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.");
        } finally {
            loader.style.display = 'none';
        }
    };

    window.saveJWT = () => {
        localStorage.setItem('pinata_jwt', document.getElementById('pinata-jwt').value);
        alert("‚úÖ Token Saved!");
    };

    function loadNFTs() {
        onSnapshot(collection(db, "nfts"), (snapshot) => {
            const list = document.getElementById('nft-list');
            list.innerHTML = '';
            snapshot.forEach(d => {
                const nft = d.data();
                const item = document.createElement('div');
                item.className = 'nft-item';
                item.innerHTML = `<span>${nft.name} ${nft.isAdmin ? 'üëë' : ''}</span><button class="del-btn" onclick="deleteNFT('${d.id}')">Delete</button>`;
                list.appendChild(item);
            });
        });
    }

    window.deleteNFT = async (id) => {
        if(confirm("Confirm deletion?")) await deleteDoc(doc(db, "nfts", id));
    };

    document.getElementById('pinata-jwt').value = localStorage.getItem('pinata_jwt') || "";
</script>
</body>
</html>
